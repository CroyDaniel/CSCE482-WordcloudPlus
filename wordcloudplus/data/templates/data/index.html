<!DOCTYPE html>
<html lang="en">

<head>
	<title>WordCloud+</title>
	<meta charset="utf-8"></meta>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
	<meta name="viewport" content = "width=device-width, initial-scale=1.0"></meta>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
</head>

<body>
	{% load static %}
	<div>
		<h1>WordCloud+</h1>
		<img src="{% static 'images/wordcloudpluslogo.png' %}" alt="Lovingly crafted by George, Sam, Matt, and Dan" style="width:480px;height:360px;"></img>
	    <script type="text/javascript">
	    	var set1Counter = 2;
	    	var set2Counter = 2;
	    	var set3Counter = 2;
			var limit = 5;

		    function addInput(divName, set){
		    	if(set == 1){
		    		if (set1Counter == limit)  {
		            	alert("You have reached the limit of adding " + limit + " inputs");
			        }
			        else {
			            var newdiv = document.createElement('div');
			            newdiv.innerHTML = "Set " + set + " URL: <input type='text' name='firstAddresses' id='firstAddr" + (set1Counter + 1) + "' required> Time Range: <input type='text' name='years' id='year" + (set1Counter + 1) + "' required><br>";
			            document.getElementById(divName).appendChild(newdiv);
		    	        set1Counter++;
			        }
		    	}

		    	if(set == 2){
		    		if (set2Counter == limit)  {
		            	alert("You have reached the limit of adding " + limit + " inputs");
			        }
			        else {
			            var newdiv = document.createElement('div');
			            newdiv.innerHTML = "Set " + set + " URL: <input type='text' name='firstAddresses' id='firstAddr" + (set2Counter + 1) + "' required> Time Range: <input type='text' name='years' id='year" + (set2Counter + 1) + "' required><br>";
			            document.getElementById(divName).appendChild(newdiv);
		    	        set2Counter++;
			        }
		    	}

		    	if(set == 3){
					if (set3Counter == limit)  {
	            		alert("You have reached the limit of adding " + limit + " inputs");
			        }
			        else {
			            var newdiv = document.createElement('div');
			            newdiv.innerHTML = "Set " + set + " URL: <input type='text' name='firstAddresses' id='firstAddr" + (set3Counter + 1) + "' required> Time Range: <input type='text' name='years' id='year" + (set3Counter + 1) + "' required><br>";
			            document.getElementById(divName).appendChild(newdiv);
		    	        set3Counter++;
			        }
		    	}
		    }

		    function removeInput(divName, set){
		    	if (document.getElementById(divName).childElementCount >= 7) {
		    		document.getElementById(divName).removeChild(document.getElementById(divName).lastChild);

			    	if (set == 1) {
			    		set1Counter--;
			    	}
			    	else if (set == 2) {
			    		set2Counter--;
			    	}
			    	else if (set == 3) {
			    		set3Counter--;
			    	}
		    	}

		    }
	    </script>
		<form action="/" method="POST">
			ONLY FIRST 2 LINKS FOR EACH SET WORK aka adding Inputs will create more inputs. But they don't get passed anywhere. Mining.py is under HEAVY construction atm. 
			<div id="set1">
				<br>
				Set 1 URL: <input type="text" name="firstAddresses" id="firstAddr1" required></input>
				Time Range: <input type="text" name="years" id="year1" required></input>
				<br>
				Set 1 URL: <input type="text" name="firstAddresses" id="firstAddr2" required></input>
				Time Range: <input type="text" name="years" id="year1" required></input>
				<br>
			</div>
			<input type="button" value="Add another text input" onClick="addInput('set1', 1);"></input>
			<input type="button" value="Remove text input" onClick="removeInput('set1', 1);"></input>
			<br>
			<br>
			<div id="set2">
				Set 2 URL: <input type="text" name="secondAddresses" id="secondAddr1" required></input>
				Time Range: <input type="text" name="years" id="year3" required></input>
				<br>
				Set 2 URL: <input type="text" name="secondAddresses" id="secondAddr2" required></input>
				Time Range: <input type="text" name="years" id="year1" required></input>
				<br>
			</div>
			<input type="button" value="Add another text input" onClick="addInput('set2', 2);"></input>
			<input type="button" value="Remove text input" onClick="removeInput('set2', 2);"></input>
			<br>
			<br>
			<div id="set3">
				Set 3 URL: <input type="text" name="thirdAddresses" id="thirdAddr1" required></input>
				Time Range: <input type="text" name="years" id="year5" required></input>
				<br>
				Set 3 URL: <input type="text" name="thirdAddresses" id="thirdAddr2" required></input>
				Time Range: <input type="text" name="years" id="year1" required></input>
				<br>
			</div>
			<input type="button" value="Add another text input" onClick="addInput('set3', 3);"></input>
			<input type="button" value="Remove text input" onClick="removeInput('set3', 3);"></input>
			<br>
			<br>
			<input type="submit" value="Submit"></input></input>
		</form> 
		
		<form action="/" method="POST" enctype='multipart/form-data'>
			Document Upload: <input type="file" name="doc" id="doc"></input>
			<br>
			<input type="hidden" value="file_upload" name="file_upload"></input>
			<input type="submit" value="Submit"></input>
			<p id="feedback1" style="visibility:hidden"/>Got it! Please click on 'Create Wordcloud' and wait a few moments. </p>
		</form>
		<input type="submit" id="create1" value="Create Wordcloud1" onclick="create1()" style="visibility:hidden"></input>
		<input type="submit" id="create2" value="Create Wordcloud2" onclick="create2()" style="visibility:hidden"></input>
		<input type="submit" id="create3" value="Create Wordcloud3" onclick="create3()" style="visibility:hidden"></input>
		<input type="range" name="points" id="timeRange" value="50" min="0" max="100" style="width: 400px;">
		<p id="feedback2"></p>
	</div>
	
	<script src="{% static 'js/d3.v3.min.js' %}"></script>
	<script src="{% static 'js/d3.layout.cloud.js' %}"></script>
	<script src="{% static 'js/d3.sample.js' %}"></script>

	<script type="text/javascript">
		function creating1(){
			document.getElementById("feedback1").style.visibility = "visible";
			document.getElementById("create1").style.visibility = "visible";
		}
		function creating2(){
			document.getElementById("feedback1").style.visibility = "visible";
			document.getElementById("create2").style.visibility = "visible";
		}
		function creating3(){
			document.getElementById("feedback1").style.visibility = "visible";
			document.getElementById("create3").style.visibility = "visible";
		}
		
		//Create a new instance of the word cloud visualisation.
		var myWordCloud = wordCloud('body');
	
		//Each derived from json, filtered, and parsed to JSON

	//First set of years
		var site_content1 = "{{site_content_json1}}";
		var words_string1 = site_content1.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");

		var site1_percentage1 = "{{site1_percentage_json1}}";
		site1_percentage1 = site1_percentage1.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");
		site1_percentage1 = JSON.parse(site1_percentage1);

		var site2_percentage1 = "{{site2_percentage_json1}}";
		site2_percentage1 = site2_percentage1.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");
		site2_percentage1 = JSON.parse(site2_percentage1);

	//Second set of years
		var site_content2 = "{{site_content_json2}}";
		var words_string2 = site_content2.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");

		var site1_percentage2 = "{{site1_percentage_json2}}";
		site1_percentage2 = site1_percentage2.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");
		site1_percentage2 = JSON.parse(site1_percentage2);

		var site2_percentage2 = "{{site2_percentage_json2}}";
		site2_percentage2 = site2_percentage2.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");
		site2_percentage2 = JSON.parse(site2_percentage2);

	//Third set of years
		var site_content3 = "{{site_content_json3}}";
		var words_string3 = site_content3.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");

		var site1_percentage3 = "{{site1_percentage_json3}}";
		site1_percentage3 = site1_percentage3.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");
		site1_percentage3 = JSON.parse(site1_percentage3);

		var site2_percentage3 = "{{site2_percentage_json3}}";
		site2_percentage3 = site2_percentage3.replace(/&quot;/g,'"').replace(/\[/g, "").replace(/\]/g, "");
		site2_percentage3 = JSON.parse(site2_percentage3);

		// console.log(site1_percentage);
		// console.log(site2_percentage);

		if (words_string1 != ""){ creating1(); }
		if (words_string2 != ""){ creating2(); }
		if (words_string3 != ""){ creating3(); }

		var words_array1 = words_string1.split(", ");
		var obj1 = { };
		var words_array2 = words_string2.split(", ");
		var obj2 = { };
		var words_array3 = words_string3.split(", ");
		var obj3 = { };

		for (var i = 0, j = words_array1.length; i < j; i++) {
			obj1[words_array1[i]] = (obj1[words_array1[i]] || 0) + 1;
		}
		for (var i = 0, j = words_array2.length; i < j; i++) {
			obj2[words_array2[i]] = (obj2[words_array2[i]] || 0) + 1;
		}
		for (var i = 0, j = words_array3.length; i < j; i++) {
			obj3[words_array3[i]] = (obj3[words_array3[i]] || 0) + 1;
		}

		var unique_words_array1 = Array.from(new Set(words_array1));
		for (var i = unique_words_array1.length - 1; i >= 0; --i) {
			var importance = obj1[unique_words_array1[i]] / unique_words_array1.length;
			if (importance < .02) { 
			//if (obj1[unique_words_array1[i]] < 5){
				obj1[unique_words_array1[i]] = 0;
				unique_words_array1.splice(i, 1);
			}else if (i >= 1){
				while ((obj1[unique_words_array1[i-1]] - obj1[unique_words_array1[i]]) > 35){
					obj1[unique_words_array1[i-1]] = obj1[unique_words_array1[i-1]]-5;
				}
			}
		}
			
		var unique_words_array2 = Array.from(new Set(words_array2));
		for (var i = unique_words_array2.length - 1; i >= 0; --i) {
			var importance = obj2[unique_words_array2[i]] / unique_words_array2.length;
			if (importance < .02) { 
			//if (obj2[unique_words_array2[i]] < 5){
				obj2[unique_words_array2[i]] = 0;
				unique_words_array2.splice(i, 1);
			}else if (i >= 1){
				while ((obj2[unique_words_array2[i-1]] - obj2[unique_words_array2[i]]) > 35){
					obj2[unique_words_array2[i-1]] = obj2[unique_words_array2[i-1]]-5;
				}
			}
		}
		
		var unique_words_array3 = Array.from(new Set(words_array3));
		for (var i = unique_words_array3.length - 1; i >= 0; --i) {
			var importance = obj3[unique_words_array3[i]] / unique_words_array3.length;
			if (importance < .02) { 
			//if (obj3[unique_words_array3[i]] < 5){
				obj3[unique_words_array3[i]] = 0;
				unique_words_array3.splice(i, 1);
			}else if (i >= 1){
				while ((obj3[unique_words_array3[i-1]] - obj3[unique_words_array3[i]]) > 35){
					obj3[unique_words_array3[i-1]] = obj3[unique_words_array3[i-1]]-5;
				}
			}
		}
		
		var words1 = unique_words_array1.map(function (d) { return {text: d, size: obj1[d]}; });
		var words2 = unique_words_array2.map(function (d) { return {text: d, size: obj2[d]}; });
		var words3 = unique_words_array3.map(function (d) { return {text: d, size: obj3[d]}; });
		
		function create1(){
			document.getElementById("feedback2").innerHTML = "Working...";
			showNewWords(1, myWordCloud, words1, site1_percentage1, site2_percentage1);
		}
		function create2(){
			document.getElementById("feedback2").innerHTML = "Working...";
			showNewWords(2, myWordCloud, words2, site1_percentage2, site2_percentage2);
		}
		function create3(){
			document.getElementById("feedback2").innerHTML = "Working...";
			showNewWords(3, myWordCloud, words3, site1_percentage3, site2_percentage3);
		}
		
	</script>

</html>


